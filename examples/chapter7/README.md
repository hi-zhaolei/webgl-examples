# Chapter 7

前几章我们了解了WebGL的工作原理，着色器的使用，矩阵的变换，动画纹理等，这一章我们主要研究几个问题：

以用户视角而进入三维世界

控制三维可视空间

裁剪

处理物体前后关系

绘制三角形

## 视线和视点

三维物体具有深度，也就是Z轴，你需要考虑亮点: 观察方向和可视距离

我们将观察者所处的诶址称为视点，从视点出发沿着观察方向的射线称作视线


### 视点，观察目标点和上方向

为了确定观察者的状态，需要获取亮项信息:

1. **视点**是观察者所在的三维空间中位置，视线的起点(eyeX, eyeY, eyeZ)

2. **观察目标点**被观察目标所在的点。视线从视点出发，穿过观察目标点并继续延伸。只有同时知道观察目标点和视点，才能算出视线的方向。观察目标点坐标(atX, atY, atZ)

3. **上方向**是绘制在屏幕上的影像中向上的方向，(upX, upY, upZ)

在WebGL中，我们可以用上述三个矢量创建一个**视图矩阵**，再将该矩阵传给顶点着色器。

Matrix4.setLookAt(eyeX, eyeY, eyeZ, atX, atY, atZ, upX, upY, upZ)

### 加入视点的顶点变换

`<视点看到的坐标> = <视图矩阵> * <模型矩阵> * <原始顶点坐标>`


## 可视范围

当视点在某些位置时，图形会缺失，这是因为我们没有指定**可视范围**，即实际观察得到的区域。

三维物体只有在可视范围内才会被WebGL渲染，不绘制可视范围外的对象是基本的降低开销的手段。

除了水平和垂直外，WebGL还会限制观察者的**可视深度**，这三者共同构成了**可视空间**

### 可视空间

常用的可视空间

#### 长方体（盒状）

由正射投影产生，生成的场景可以方便的比较场景中物体大小，适合建筑平面图等技术绘图场景。

![盒状可视空间]('../../pic/box_scene.png')

可视空间由前后两个矩形表面确定，分别为**近裁剪面**和**远裁剪面**, canvas上显示的就是可视空间中的物体在**近裁剪面**上的投影。如果裁剪面的宽高比和canvas不一样，那么画面会被压缩并扭曲。近裁剪面和远裁剪面中间的区域就是可视空间，只有在此空间内的物体才会被显示出来。

#### 正射投影矩阵

`Matrix4.setOrtho(left, right, bottom, top, near, far)`

通过各参数计算正射投影矩阵，将其存储在Matrix4中。left和right，top和bottom不一定相等，near与far不能相等

|----|-----|------|
|参数|left,rigght|指定近裁剪面的左边界和右边界|
||bottom,top|指定近裁剪面的上边界和下边界|
||near,far|指定近裁剪面和远裁剪面的位置，即可视空间的近边界和远边界|
|返回值|无||

#### 四棱锥（金字塔）

由透视投影产生，生成的场景看上去更有深度，更自然，更贴近现实，适合大多数真实场景需求。


