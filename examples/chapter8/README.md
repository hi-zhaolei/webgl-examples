# 光照

光照使场景更具有层次感，更贴近现实。

## 光照原理

现实世界中，当光线照射到物体上时，会发生两个现象:

* 根据光源和光线方向，无题不同表面的明暗成都变得不一致（着色）

* 根据光源和光线方向，物体向地面投下影子（阴影)

### 光源类型

#### 平行光

无限远处的光源发出的光，光线是相互平行的，具有方向。可以用一个方向和一个颜色来定义

#### 电光源光

从一个点向周围所有方向发出的光，光线的方向将根据点光源的位置和被照射之处的位置计算。

#### 环境光

经光源发出后被其他物体多次反射再照到物体表面的光，环境光强度与角度无关。用一个颜色来定义。

### 反射类型

物体向哪个方向反射光和反射光颜色取决于两个因素: 入射光和物体表面类型。

入射光包括入射光方向和颜色

物体颜色包括表面固有色和反射特性

反射光公式: `<反射光颜色> = <漫反射光颜色> + <环境反射光颜色>`

#### 漫反射(diffuse reflection)

针对平行光和点光源

反射光的颜色取决于入射光的颜色，表面的基底色，入射光与表面形成的入射角(入射光与表面的法线夹角Ɵ)。

漫反射各方向均匀

漫反射光公式: `<漫反射光颜色> = <入射光颜色> * <表面基底色> * cosƟ`

入射角公式: `<cosƟ> = <光线方向> * <法线方向>`

光线方向是入射光反方向，光线和法线长度必须为1，使用GLSL ES提供的内置函数进行**归一化(normailize函数)**处理

入射光方向根据光源不同算法不同

平行光光线方向固定，直接**归一化**后计算即可

[demo](http://127.0.0.1:3000/chapter8/lesson1)

点光源光线方向为发散型，先计算顶点变换后世界坐标`<顶点世界坐标> = <模型矩阵> * <顶点坐标>`，再将点光源位置与其相减后`<光线方向> = <电光源位置> - <顶点世界坐标>`，再进行**归一化**得到光线方向。

[demo](http://127.0.0.1:3000/chapter8/lesson3)

##### 法线

物体表面的朝向，即垂直于表面的方向。

一个表面具有2个法向量，分别是表面正面和背面的法向量，顶点顺时针是正面，逆时针是反面。

平面的法向量是唯一的，法向量只表示方向

#### 环境反射(enviroment reflection)

针对环境光

反射光方向是入射光反方向

反射光各方向均匀，强度相等

环境反射公式: `<环境反射光颜色> = <入射光颜色(环境光颜色)> * <表面基底色>`

[demo](http://127.0.0.1:3000/chapter8/lesson1)

## 运动物体

假如立方体进行旋转，每个表面颜色会根据旋转角度而发生变化，因为每个表面的法向量在不断变化。

平移不会改变法向量

旋转会改变法向量

缩放一般情况下xyz轴上缩放值相同，则不会改变法向量，反之，则会改变。

### 逆转置矩阵

`<变换后法向量> = <模型矩阵的逆转置矩阵> * <法向量>`

逆转置矩阵计算，求原矩阵M的逆矩阵R(M\*R|R\*M为单位矩阵)，再将逆矩阵进行转置(行列互换)

| 方法 | 描述 |
|---|---|
| Matrix4.setInverseOf(M)|使自身成为矩阵M的逆矩阵|
| Matrix4.tranpose()|对自身进行转置操作，并将自身设为专职后的结果|

[demo1](http://127.0.0.1:3000/chapter8/lesson2)
[demo2](http://127.0.0.1:3000/chapter8/lesson3)

## 逐片元光照

WebGL系统会根据顶点的颜色，内插出表面上每个片元的颜色。所以为了使看到的效果更加逼真，我们需要对表面的每一点计算光照效果。

为了逐片元计算光照，需要知道 片元在世界坐标系下的坐标和片元处表面的法向量

[demo](http://127.0.0.1:3000/chapter8/lesson4)